@model EmployeeMyProfileModel
@{
    Layout = "_Layout";
}
<main class="main">
    <section class="section-box mt-50">
        <div class="container">
            <div class="row">
                <div class="col-md-12 mb-50">
                    <div class="content-single">
                        <div class="tab-content">
                            <div class="tab-pane fade show active" id="tab-my-profile" role="tabpanel" aria-labelledby="tab-my-profile">
                                <div class="row">
                                    <div class="col-md-8">
                                        <h3 class="mt-0 mb-15 color-brand-1">Hesabım</h3>
                                        <a class="font-md color-text-paragraph-2" href="#">Profilinizi Güncelleyin</a>
                                    </div>
                                    <div class="col-md-4 text-end" style="align-self: center">
                                        <a class="btn btn-preview-icon btn-apply btn-apply-big" href="/profil/@Model.EmployeeInformation.UserId">Önizleme</a>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="mt-35 box-info-profie">
                                            <div class="image-profile">
                                                <img src="@Model.EmployeeInformation.ProfilePhoto">
                                            </div>
                                            <button onclick="uploadPhotoClicked()" class="btn btn-apply">Fotoğraf Yükle</button>
                                            <form name="profilePhotoForm" asp-controller="Profile" asp-action="UpdateProfilePhoto" method="post" enctype="multipart/form-data">
                                                <input hidden type="file" name="ProfilePhoto" onchange="submitForm()" class="profile-photo-input" />
                                            </form>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-lg-8 col-md-12">
                                        <h5 class="f-18 mb-0">@Model.EmployeeInformation.Name @Model.EmployeeInformation.Surname</h5>
                                        <p class="mt-0 font-md color-text-paragraph-2 mb-15">İş arayan</p>
                                    </div>
                                </div>

                                <div class="row form-contact">
                                    <div class="col-lg-6 col-md-12">
                                        <form asp-controller="Profile" asp-action="UpdateEmployeeInformation" method="post">
                                            <div class="form-group">
                                                <label class="font-sm color-text-mutted mb-10">Ad *</label>
                                                <input class="form-control" asp-for="@Model.EmployeeInformation.Name"
                                                       data-val="true" data-val-required="Ad gerekli.">
                                                <div class="error-message" data-valmsg-for="EmployeeInformation.Name" data-valmsg-replace="true"></div>
                                            </div>
                                            <div class="form-group">
                                                <label class="font-sm color-text-mutted mb-10">Soyad *</label>
                                                <input class="form-control" asp-for="@Model.EmployeeInformation.Surname"
                                                       data-val="true" data-val-required="Soyad gerekli.">
                                                <div class="error-message" data-valmsg-for="EmployeeInformation.Surname" data-valmsg-replace="true"></div>
                                            </div>
                                            <div class="form-group">
                                                <label class="font-sm color-text-mutted mb-10">E-posta *</label>
                                                <input class="form-control" type="email" asp-for="@Model.EmployeeInformation.Email"
                                                       data-val="true" data-val-required="Email gerekli.">
                                                <div class="error-message" data-valmsg-for="EmployeeInformation.Email" data-valmsg-replace="true"></div>
                                            </div>
                                            <div class="form-group">
                                                <label class="font-sm color-text-mutted mb-10">Telefon *</label>
                                                <input class="form-control" asp-for="@Model.EmployeeInformation.Phone"
                                                       data-val="true" data-val-required="Telefon gerekli.">
                                                <div class="error-message" data-valmsg-for="EmployeeInformation.Phone" data-valmsg-replace="true"></div>
                                            </div>
                                            <div class="form-group">
                                                <label class="font-sm color-text-mutted mb-10">TCKN *</label>
                                                <input class="form-control" asp-for="@Model.EmployeeInformation.Tckn"
                                                       data-val="true" data-val-required="TCKN gerekli.">
                                                <div class="error-message" data-valmsg-for="EmployeeInformation.Tckn" data-valmsg-replace="true"></div>
                                            </div>
                                            <div class="border-bottom pt-10 pb-10 mb-30"></div>
                                            <h6 class="color-orange mb-20">Parolanızı Değiştirin</h6>
                                            <div class="row">
                                                <div class="col-lg-6">
                                                    <div class="form-group">
                                                        <label class="font-sm color-text-mutted mb-10">Yeni Parola</label>
                                                        <input class="form-control" type="password" asp-for="@Model.EmployeeInformation.NewPassword">
                                                    </div>
                                                </div>
                                                <div class="col-lg-6">
                                                    <div class="form-group">
                                                        <label class="font-sm color-text-mutted mb-10">Yeni Parola Tekrar *</label>
                                                        <input class="form-control" type="password" asp-for="@Model.EmployeeInformation.NewPasswordAgain">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="box-button mt-15">
                                                <button class="btn btn-apply-big font-md font-bold">Bilgileri Güncelle</button>
                                            </div>
                                        </form>
                                    </div>
                                    <div class="col-lg-6 col-md-12">
                                        <div class="box-skills">
                                            <div class="row">
                                                <div class="col-md-8">
                                                    <h5 class="mt-0 color-brand-1">İlgi Alanları</h5>
                                                </div>
                                                <div class="col-md-4 text-end">
                                                    <a id="addInterestBtn" class="btn btn-apply" data-bs-toggle="modal" data-bs-target="#ModalAddInterest">Ekle</a>
                                                </div>
                                            </div>
                                            <div class="box-tags mt-30">
                                                @foreach (var interest in Model.Interests)
                                                {
                                                    <a class="btn btn-grey-small mr-10">@interest.Name<span onclick="deleteInterest(@interest.Id)" class="close-icon"></span></a>
                                                }
                                            </div>
                                        </div>
                                        <div class="box-skills">
                                            <div class="row">
                                                <div class="col-md-8">
                                                    <h5 class="mt-0 color-brand-1">Çalışma Deneyimleri</h5>
                                                </div>
                                                <div class="col-md-4 text-end">
                                                    <a class="btn btn-apply" data-bs-toggle="modal" data-bs-target="#ModalAddExperience">Ekle</a>
                                                </div>
                                            </div>
                                            <div class="col-xl-12 col-12">
                                                @foreach (var workExperience in Model.WorkExperiences)
                                                {
                                                    <div class="card-grid-2 hover-up wow animate__ animate__fadeIn animated" style="visibility: visible; animation-name: fadeIn;">
                                                        <div class="card-block-info">
                                                            <div class="row">
                                                                <div class="col-md-10">
                                                                    <h5>@workExperience.Title</h5>
                                                                </div>
                                                                <div class="col-md-2 text-end">
                                                                    <a class="link-red mt-4 py-2 px-1" style="cursor: pointer" onclick="deleteWorkExperience(@workExperience.Id)">Sil</a>
                                                                </div>
                                                            </div>
                                                            <p class="font-sm color-text-paragraph mt-10">@workExperience.Description</p>
                                                        </div>
                                                    </div>
                                                }
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</main>
<div class="modal fade" id="ModalAddInterest" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content apply-job-form">
            <button class="btn-close" type="button" data-bs-dismiss="modal" aria-label="Close"></button>
            <div class="modal-body pl-30 pr-30 pt-50">
                <div class="text-center">
                    <p class="font-sm text-brand-2">İlgi Alanları </p>
                    <h2 class="mt-10 mb-5 text-brand-1 text-capitalize">İlgi Alanlarınızı Seçin</h2>
                </div>
                <div class="box-tags mt-30">
                    @foreach (var tag in Model.Tags)
                    {
                        <a onclick="addInterest(@tag.Id)" class="btn btn-grey-small mr-10">@tag.DisplayName</a>
                    }
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="ModalAddExperience" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content apply-job-form">
            <button class="btn-close" type="button" data-bs-dismiss="modal" aria-label="Close"></button>
            <div class="modal-body pl-30 pr-30 pt-50">
                <div class="text-center">
                    <p class="font-sm text-brand-2">Çalışma Deneyimi</p>
                    <h2 class="mt-10 mb-5 text-brand-1 text-capitalize">Çalışma Deneyimi Ekleyin</h2>
                </div>
                <form class="login-register text-start mt-20 pb-30" method="post" asp-action="AddWorkExperience" asp-asp-controller="Profile">
                    <div class="form-group">
                        <label class="form-label" for="input-1">Başlık *</label>
                        <input class="form-control" id="input-1" type="text" name="title" placeholder="Başlık"
                               data-val="true" data-val-required="Başlık gerekli.">
                        <div class="error-message" data-valmsg-for="title" data-valmsg-replace="true"></div>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="input-2">Açıklama *</label>
                        <textarea class="form-control" style="height: auto" id="input-2" type="text" name="description" placeholder="Açıklama" rows="8"></textarea>
                    </div>
                    <div class="form-group">
                        <button class="btn btn-default hover-up w-100" type="submit">Kaydet</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
@section scripts {
    <script>
        let uploadPhotoClicked = () => {
            $(".profile-photo-input").click();
        }

        let submitForm = () => {
            console.log("submitting form");
            document.forms["profilePhotoForm"].submit();
        }

        let addInterest = (id) => {
            $.ajax({
                url: "/Profile/AddInterest?id=" + id,
                type: "GET",
                success: function (data) {
                    toastr.success(data.message)
                    setTimeout(() => {
                        location.reload();
                    }, 1000);
                },
                error: function (data) {
                    toastr.error(data.message)
                }
            })
        }

        let deleteInterest = (id) => {
            $.ajax({
                url: "/Profile/DeleteInterest?id=" + id,
                type: "GET",
                success: function (data) {
                    toastr.success(data.message)
                    setTimeout(() => {
                        location.reload();
                    }, 1000);
                },
                error: function (data) {
                    toastr.error(data.message)
                }
            })
        }

        let deleteWorkExperience = (id) => {
            $.ajax({
                url: "/Profile/DeleteWorkExperience?id=" + id,
                type: "GET",
                success: function (data) {
                    toastr.success(data.message)
                    setTimeout(() => {
                        location.reload();
                    }, 1000);
                },
                error: function (data) {
                    toastr.error(data.message)
                }
            })
        }
    </script>
}